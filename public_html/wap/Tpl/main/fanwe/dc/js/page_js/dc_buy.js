window.addEventListener('load', function() {	FastClick.attach(document.body);}, false);var query;var attr;$(document).ready(function(){	attr=[];	/*$('.del_one').live('click',function(){		var num=-1;		dc_change_num($(this),num);	});		$('.add_one').live('click',function(){		var num=1;		dc_change_num($(this),num);	});*/			$('#dc_cart_clear').live('click',function(){		dc_cart_clear();			});	$('.btn-close,.dish-detail-close').live('click',function(){		$('.dish-detail-container').hide();	});	// 查看图片	$('.p020-155>img').live('click',function(){		var title = $(this).parent().find('.title');		var fu_title = $(this).parent().find('.fu_title');		var price = $(this).parent().find('.price');		var image = $(this).parent().find('.image');		var m_desc = $(this).parent().find('.m_desc');		$('#detail-container').find('.dish-desc-title').text(title.text());		$('#detail-container').find('.dish-desc-subtitle').text(fu_title.text());		$('#detail-container').find('.dish-desc-price--bold').text(price.text());		$('#detail-container').find('.dish-desc-image').html('<img src="'+ image.text()+'" alt="毛毛虫" class="loaded" style="width: 100%; height:100%;">');		$('#detail-container').find('.dish-desc-desc').html(m_desc.text());		$('#detail-container').show();	});    // $('.dish-porps-option').live('click',function () {		// if($(this).hasClass('is-checked')){    //         $(this).removeClass('is-checked');		// }else{    //         $(this).addClass('is-checked');		// }    //    // });	// 点击减号    $('.counter-minus').live('click',function () {        var obj = $(this).parent().find('.counter-num');        var count = parseInt($(obj).html());		if(count == 0){			alert('不能为负数');			return false;		}else{            count --;            $(obj).html(count);		}    });    // 点击加号    $('.counter-add').live('click',function () {    	var obj = $(this).parent().find('.counter-num');        var count = parseInt($(obj).html());        count ++;        $(obj).html(count);    });    $('#dc_total ,#dc_cart_close').live('click',function(){		$('#dc_cart').slideToggle();	});	// $(document).on('click', $('#dc_total ,#dc_cart_close'),function(){	// 	dc_cart_clear();			// });		// $(document).on('click', $('#dc_total ,#dc_cart_close'),function(){	// 	$('#dc_cart').slideToggle();			// });	$('button').live('click',function (e) {		var price = $(this).attr('data-price');		// if(isNaN(price)){         //    $('.price').html(price);		// }else{         //    $('.price').html(0);		// }		// alert(price);    });	//加入购物车	$('.btn--yellow').live('click',function (e) {		var menuid =   $('input[name=menuid]').val();		var number = parseInt($('div[menu-id='+menuid+']').find('.special-count').html()) + parseInt($('.dish-detail-addtocarta .counter-num').html());		$('.menu_right[menu-id='+menuid+']').find('.special-count').html(number);		$('span[cart-menuid='+menuid+']').html(number);		$('.f_r[menu-id='+menuid+']').attr('menu-count',number);		addToCart();        change_left();    });	change_left();});/** * 显示属性，ajax数据库查询 * @param obj */function show(obj){    var oname = $(obj).parent().parent().parent().parent().find('h6').html();//分类名称    var oprice = $(obj).parent().parent().parent().parent().find('.f_fa952f').html();//默认价格    var menuid = $(obj).parent().parent().parent().parent().find('.menu_right').attr('menu-id');//菜单id	$('input[name=menuid]').val(menuid);    $('.dish-name').html(oname);    $('.dish-price').html(oprice).show();	$.get('/wap/index.php?ctl=dcbuy&act=dcattr&lid='+location_id+'&id='+$(obj).parent().attr('menu-id'),function (e) {		$('#detail-container-all').show();        $('#detail-container-all').find('.counter-num').html(0);		if(e != null){			var results = JSON.parse(e);            $('.dish-props-select').html('');			for(var i=0;i<results.length;i++){                var html = '';                html += '<div class="clearfix"></div>';                html += '<div class="recipe-group"><span class="recipe-title">'+results[i].name+'</span>'+                '<div class="active-select">'+                '<div class="optionsData-wrapper clearfix">';				if(results[i].flavor != null){					var falvors = JSON.parse(results[i].flavor);					var innerHtml = '';                    for(var j=0;j<falvors.length;j++) {                        innerHtml += '<button onclick="changeCart(this)" class="dish-porps-option" menu-id="'+menuid+'" data-id="'+results[i].id+'" data-price="'+falvors[j].price+'"><span class="flex-row"><span class="name ellipsis flex-rest">'+ decodeURI(falvors[j].name)+'</span><span class="extra flex-none">+'+falvors[j].price+'元</span></span></button>';                    }                    html += innerHtml;				}                html += '</div>'+                    '</div>'+                    '</div>';				$('.dish-props-select').append(html);			}		}	})}/** * 点击属性保存信息 * @param args */function changeCart(args){	var obj = $(args);	if(obj.hasClass('is-checked')){		obj.removeClass('is-checked');	}else{		obj.addClass('is-checked');	}	if(parseInt($('.dish-detail-addtocarta .counter-num').html()) == 0){        $('.dish-detail-addtocarta .counter-add').click();	}	var price = parseFloat($('.dish-price').html().substr(1));	var name = obj.find('.name').html();	var extra = obj.find('.extra').html();	if(obj.hasClass('is-checked')){		if(!attr.toString().indexOf(name)>-1) {			attr.push(name);			price += parseFloat(extra);		}	}else {		price -= parseFloat(extra);	}    $('.dish-price').html('&yen'+ price);    if(attr != []){    	query = {};        query.id=obj.attr('data-id');        query.menu_id=obj.attr('menu-id');        query.number = parseInt($('.dish-detail-addtocarta .counter-num').html());        query.tid=tid;        query.location_id=location_id;        query.supplier_id=supplier_id;        query.distance=distance;        query.act='attr_dc_add_cart';        query.name = $('.dish-name').html();        query.price = price;        query.remark = attr.toString();	}}function addToCart(){	if(attr.length == 0){        if(parseInt($('.dish-detail-addtocarta .counter-num').html()) == 0){            $('.dish-detail-addtocarta .counter-num').click();        }		var parent = $('#detail-container-all');		var menu_id =  $('input[name=menuid]').val();		var data_id = '';		var num = parseInt($('.dish-detail-addtocarta .counter-num').html());        var price = parseFloat($('.dish-price').html().substr(1));        query = {};        query.id=data_id;        query.menu_id=menu_id;        query.number = num;        query.tid=tid;        query.location_id=location_id;        query.supplier_id=supplier_id;        query.distance=distance;        query.act='attr_dc_add_cart';        query.name = $('.dish-name').html();        query.price = price;        query.remark = '';	}else{		attr = [];	}	$('#detail-container-all').hide();    if(parseInt($('.dish-detail-addtocarta .counter-num').html()) == 0){        alert('数量不能为负数');        return false;    }    $.ajax({        url:'/wap/index.php?ctl=dcajax',        data:query,        type:'post',        dataType:'json',        async:"true",        success:function(data){            if(data.status==1){                $('#dc_cartsection').html(data.html);                $('.total_price').html(data.total_price);            }        }    });}/*左侧数量变化 */function change_left(){	$.each($(".main_cate li"),function(index,data){		var rel = $(data).attr("rel");		var sub_menu = $(".sub_menu_" + rel + " li");		var li_count = 0;		$.each(sub_menu, function (e,d) {			var fr = $(d).find(".menu_right .f_r");			//var li_count =			var count = fr.attr("menu-count");			li_count += parseFloat(count);		});		//alert(li_count);		var szdd = $(data).find(".szdd");		szdd.html(li_count);		if(li_count == 0){			szdd.hide();		}else{			szdd.show();		}	})}function del(obj){	var num=-1;    dc_change_num($(obj),num);	change_left();}function add(obj){	var num=1;	dc_change_num($(obj),num);	change_left();}function dc_change_num(o,num){		var menu_o= o.parent();		var menu_id=parseInt(menu_o.attr('menu-id'));		var number=parseInt(num);		var number_x=parseInt(menu_o.html())+num;		var ajaxurl=DC_AJAX_URL;		var query=new Object();		query.menu_id=menu_id;		query.number=number;		query.tid=tid;		query.location_id=location_id;		query.supplier_id=supplier_id;		query.distance=distance;		query.act='dc_add_cart';		var ye_number = parseInt(menu_o.find(".w054").html());		if(isNaN(ye_number)){			ye_number = 0; 		}		var numm = ye_number+number;		if(numm <= 0){			$("span[cart-menuid='"+menu_id+"']").html(0)			$("span[cart-menuid='"+menu_id+"']").addClass("hide1");			$("span[del-menuid='"+menu_id+"']").addClass("hide1");			 var card_add = '<div class="f_r" menu-id="'+menu_id+'" menu-count="0">'+			'<span class="f_l block w040 h040 tc bor_7 bdr3 lh034 del_one hide1" onclick="del(this)" del-menuid="'+menu_id+'"><i class="icon iconfont f_fe4d3d f024 delicon"></i></span>'+			'<span class="f_fe4d3d f_l block h044 w054 lh044 tc hide1" cart-menuid="'+menu_id+'">0</span>'+			'<span class="f_l block w040 h040 tc bor_7 bdr3 lh034 add_one" onclick="add(this)"><i class="icon iconfont f_fe4d3d f024 addicon"></i></span></div>';			 //$(".menu_right[menu-id='"+menu_id+"']").html(card_add);			menu_o.attr("menu-count",0);		}else{			// var card_add = '<div class="f_r" menu-id="'+menu_id+'" menu-count="'+numm+'">'+			// '<span class="f_l block w040 h040 tc bor_7 bdr3 lh034 del_one"><i class="icon iconfont f_fe4d3d f024 delicon"></i></span>'+			// '<span class="f_fe4d3d f_l block h044 w054 lh044 tc">'+numm+'</span>'+			//'<span class="f_l block w040 h040 tc bor_7 bdr3 lh034 add_one"><i class="icon iconfont f_fe4d3d f024 addicon"></i></span></div>';			menu_o.attr("menu-count",numm);			var card_add = '<div class="f_r" menu-id="'+menu_id+'" menu-count="0">'+			'<span class="f_l block w040 h040 tc bor_7 bdr3 lh034 del_one hide1" onclick="del(this)" del-menuid="'+menu_id+'"><i class="icon iconfont f_fe4d3d f024 delicon"></i></span>'+			'<span class="f_fe4d3d f_l block h044 w054 lh044 tc hide1" cart-menuid="'+menu_id+'">0</span>'+			'<span class="f_l block w040 h040 tc bor_7 bdr3 lh034 add_one" onclick="add(this)"><i class="icon iconfont f_fe4d3d f024 addicon"></i></span></div>';			$("span[cart-menuid='"+menu_id+"']").removeClass("hide1");			$("span[del-menuid='"+menu_id+"']").removeClass("hide1");			$("span[cart-menuid='"+menu_id+"']").html(numm);			//$(".menu_right[menu-id='"+menu_id+"']").html(card_add);		}				$.ajax({				url:ajaxurl,				data:query,				type:'post',				dataType:'json',				async:"true",				success:function(data){					if(data.status==1){					$('#dc_cartsection').html(data.html);										$('.total_price').html(data.total_price);										}				}		});		}function dc_cart_clear(){		var query=new Object();		var ajaxurl=DC_AJAX_URL;		query.location_id=location_id;		query.act='dc_cart_clear';		$.ajax({				url:ajaxurl,				data:query,				type:'post',				dataType:'json',				success:function(data){					if(data.status==1){						location.href=location.href;					}				}		});		}